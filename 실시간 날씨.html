<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <title>실시간 날씨 정보 받아오기</title>
    <style>
        *{margin: 0 auto; padding:0;
            text-align: center;
        }
        body{
            height:100vh;
            /* background:url("https://cdn.pixabay.com/photo/2021/08/23/08/28/path-6567149_960_720.jpg"); */
            /* background-size: cover;
            background-position: center center; */
        }
        .search{
            text-align: center;
            margin-bottom: 60px;
        }
        .weather{
            padding-top: 100px;
        }
        .search input{
            font-size: 1.2rem;
            background:rgba(0,0,0,.3);
            border-radius: 5%;
            border:none;
            color:#fff;
        }
        .icon{
            height:100px;
        }
        .dataBox{
            width:240px;
            border-radius: 10px;
            background:rgba(0,0,0,.3);
            padding:20px;
            box-sizing:border-box;
            color:#fff;
        }
        .temp{
            line-height: 60px;
            font-size: 2rem;
            font-weight: bold;
        }
    </style>
</head>
<body onload="go()">
    <div class="weather">
        <div class="search">
            <input type="search" name="" id="" class="citySearch">
        </div>
        <div class="dataBox">
            <div class="name"></div>
            <div class="icon"></div>
            <div class="text"></div>
            <div class="temp"></div>
            <div class="time"></div>
        </div>
    </div>

    <script>
        /* 
        날씨 키값(api key)
        02a146d88b51a0a88235d8a46514d112
        
        도시 코드
        1841066

        
        api.openweathermap.org/data/2.5/weather?q=mokpo&appid=02a146d88b51a0a88235d8a46514d112
        
        날씨 예보
        http://api.openweathermap.org/data/2.5/forecast?id=524901&appid={API key}
        http://api.openweathermap.org/data/2.5/forecast?id=1841066&appid=02a146d88b51a0a88235d8a46514d112&units=metric

        현재시간 날씨
        http://api.openweathermap.org/data/2.5/weather?id=2172797&appid={API key}
        http://api.openweathermap.org/data/2.5/weather?id=1841066&appid=02a146d88b51a0a88235d8a46514d112&units=metric

        json 코드 이쁘게 변환
        https://jsonbeautifier.org/

        {
            "dt":1630227600,
            "main":{
                "temp":27.03,
                "feels_like":30.71,
                "temp_min":25.54,
                "temp_max":27.03,
                "pressure":1013,
                "sea_level":1013,
                "grnd_level":1012,
                "humidity":89,
                "temp_kf":1.49
            },
            "weather":[
                {
                    "id":804,
                    "main":"Clouds",
                    "description":"overcast clouds",
                    "icon":"04d"
                }
            ],
            "clouds":{
                "all":95
            },
            "wind":{
                "speed":2.66,
                "deg":251,
                "gust":3.38
            },
            "visibility":10000,
            "pop":0.16,
            "sys":{
                "pod":"d"
            },
            "dt_txt":"2021-08-29 09:00:00"
        }
        */

        /* 
        $.getJSON('URL',function(data){
            //data로 할일
        });
         */
        /* 
        날씨 아이콘 경로    
            http://openweathermap.org/img/wn/10d@2x.png
        */
       
        // 날씨 예보
        //  $.getJSON('http://api.openweathermap.org/data/2.5/forecast?id=1841066&appid=02a146d88b51a0a88235d8a46514d112&units=metric',function(data){
        //     var time =new Date(data.list[0].dt*1000);
        //     weather.innerHTML += time + " ";
        //     weather.innerHTML += data.city.name + " ";
        //     weather.innerHTML += data.city.country + " ";
        //     weather.innerHTML += data.list[0].main.temp + "도 ";
        //     weather.innerHTML += `<img src='http://openweathermap.org/img/wn/${data.list[0].weather[0].icon}@2x.png'>`;
        // });

        // 현재 날씨
        // $.getJSON('http://api.openweathermap.org/data/2.5/weather?id=1841066&appid=02a146d88b51a0a88235d8a46514d112&units=metric',function(data){
        //     var time =new Date(data.dt*1000);
        //     weather.innerHTML += time + " ";
        //     weather.innerHTML += data.name + " ";
        //     weather.innerHTML += data.sys.country + " ";
        //     weather.innerHTML += data.main.temp + "도 ";
        //     weather.innerHTML += `<img src='http://openweathermap.org/img/wn/${data.weather[0].icon}.png'>`;
        // });

        // var requestURL = 'http://api.openweathermap.org/data/2.5/weather?id=1841066&appid=02a146d88b51a0a88235d8a46514d112&units=metric';
        // var xhr = new XMLHttpRequest();
        // xhr.open('GET', requestURL);
        // xhr.responseType='json';
        // xhr.onload = function() {
        //     var data = xhr.response;

        //     //수정가능
        //     var time =new Date(data.dt*1000);
        //     weather.innerHTML += time + " ";
        //     weather.innerHTML += data.name + " ";
        //     weather.innerHTML += data.sys.country + " ";
        //     weather.innerHTML += data.main.temp + "도 ";
        //     weather.innerHTML += `<img src='http://openweathermap.org/img/wn/${data.weather[0].icon}.png'>`;
        // };
        // xhr.send();
        
        //http://openweathermap.org/img/wn/10d@2x.png
        //https://api.openweathermap.org/data/2.5/weather?q=mokpo&appid=02a146d88b51a0a88235d8a46514d112&units=metric
        
        var bgImg = [
            { url : "https://cdn.pixabay.com/photo/2019/08/19/07/45/dog-4415649_960_720.jpg", weatherMain : "Rain" },
            { url : "https://cdn.pixabay.com/photo/2021/08/23/08/28/path-6567149_960_720.jpg", weatherMain : "Clouds" },
            { url : "https://cdn.pixabay.com/photo/2017/10/01/09/40/grassland-2804703_960_720.jpg", weatherMain : "Clear" },
            { url : "https://cdn.pixabay.com/photo/2015/12/08/05/58/ice-skates-1082514_960_720.jpg", weatherMain : "Snow" },
            { url : "https://cdn.pixabay.com/photo/2017/07/30/23/59/garlic-2556022_960_720.jpg", weatherMain : "other" },
        ];
        window.addEventListener('keydown', press);
        
        var citySearch = document.querySelector(".citySearch");
        var icon = document.querySelector(".icon");
        var $name = document.querySelector(".name");
        var text = document.querySelector(".text");
        var temp = document.querySelector(".temp");
        var time = document.querySelector(".time");
        var bg = document.querySelector("body");

        function press(e){
           if(e.keyCode == 13) go();
        }
        function go(){
            var city = citySearch.value;
            city = city ? city : "mokpo";
            //if(city){city = city}else{city = "mokpo"}
            $.getJSON(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=02a146d88b51a0a88235d8a46514d112&units=metric`,function(data){
            
            //console.log(data.weather[0].icon);
            icon.innerHTML = `<img src='http://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png' alt=''>`
            var t = new Date(data.dt*1000);
            
            var tHours = t.getHours() > 12 ? "PM " + (t.getHours() - 12) : "AM " + t.getHours();
            $name.innerHTML = data.name;
            text.innerHTML = data.weather[0].main;
            temp.innerHTML = data.main.temp + "&deg;C";
            time.innerHTML = tHours+"시 "+t.getMinutes()+"분";

            for(var i=0; i<bgImg.length; i++){
                var mainText = bgImg[i].weatherMain;
                
                if(mainText.indexOf(data.weather[0].main)==0){
                    bg.style.background = `url(${bgImg[i].url})`;
                    break;
                }else{
                    bg.style.background = `url(${bgImg[bgImg.length-1].url})`;
                }
            }
            bg.style.backgroundSize = "cover";
            bg.style.backgroundPosition = "center center";

            });
        }    

        
    </script> 
     
</body>
</html>